# Configuration file of Harbor

# The IP address or hostname to access admin UI and registry service.
hostname: {{ harbor_domain }}

# http related config
http:
  # port for http, default is 80. If https enabled, this port will redirect to https port
  port: 80

# https related config
https:
  # https port for harbor, default is 443
  port: 443
  # The path of cert and key files for nginx
  certificate: /data/cert/harbor.crt
  private_key: /data/cert/harbor.key

# The initial password of Harbor admin
# It only works in first time to install harbor
# Remember Change the admin password from UI after launching Harbor.
harbor_admin_password: {{ harbor_admin_password }}

# Harbor DB configuration
database:
  # The password for the root user of Harbor DB. Change this before any production use.
  password: root123
  # The maximum number of connections in the idle connection pool. If it <=0, no idle connections are retained.
  max_idle_conns: 50
  # The maximum number of open connections to the database. If it <= 0, then there is no limit on the number of open connections.
  max_open_conns: 100

# The default data volume
data_volume: /data

# Trivy configuration
trivy:
  # Enable or disable Trivy scanner
  enabled: true
  # Skip verifying certificate
  insecure: false
  # Ignore unfixed vulnerabilities
  ignore_unfixed: false

# Log configurations
log:
  # options are debug, info, warning, error, fatal
  level: info
  # Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.
  rotate_count: 50
  # Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes. 
  # If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G are all valid.
  rotate_size: 200M
  # The directory on your host that store log
  location: /data/log

# jobservice configuration
jobservice:
  # Maximum number of job workers in job service
  max_job_workers: 10
  # The logger for jobs: "file", "database" or "stdout"
  job_loggers:
    - name: "FILE"
      level: "INFO"
      settings:
        base_dir: "/var/log/jobs"
    - name: "STDOUT"
      level: "INFO"
  # The logger sweeper duration
  logger_sweeper_duration: 1

# Notification configuration
notification:
  # Maximum retry count for webhook job
  webhook_job_max_retry: 10

# Chart repository
chart:
  # Change the value of absolute_url to enabled can enable absolute url in chart
  absolute_url: disabled

# Clair configuration
clair:
  # The interval of clair updaters, the unit is hour, set to 0 to disable the updaters
  updaters_interval: 12

# Registry configuration
registry:
  # Default registry root directory. This is backwards compatible.
  # If you want to use a different registry directory, do the following first:
  # 1. stop existing Harbor service if any
  # 2. modify storage_service.filesystem.rootdirectory to the desired value
  # 3. clean up existing Harbor storage directory
  # 4. restart Harbor service
storage_service:
    # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore
    # of registry's and chart repository's containers.  This is usually needed when the user hosts a internal storage with self signed certificate.
    ca_bundle:
    # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss
    # for more info about this configuration please refer https://docs.docker.com/registry/configuration/
  filesystem:
      maxthreads: 100
      rootdirectory: /storage
    # set disable to true when you want to disable registry redirect
    redirect:
      disabled: false

# Core configurations
core:
  # Secret key used for encryption/decryption
  secret: "{{ lookup('password', '/dev/null chars=ascii_lowercase,digits length=16') }}"
  # The expiration time (in minutes) of the token generated by core
  token_expiration: 30
  # The URL of local core endpoint
  local_core_url: http://core:8080
  # The URL for core to talk to token service
  token_service_url: http://core:8080/service/token
  # Determine whether the job service should verify the ssl cert when it connects to a remote registry
  verify_remote_cert: true
  # The XSRFKey will be used as the random key for generating xsrf token
  xsrf_key: "{{ lookup('password', '/dev/null chars=ascii_lowercase,digits length=32') }}"
  # The expiration time (in minutes) of the XSRF token
  xsrf_expiry: 60

# Portal configurations
portal:
  # The public url for portal
  public_url: ""

# External Redis configurations
external_redis:
  # support redis, redis+sentinel
  # host for redis: <host>:<port>, e.g. 127.0.0.1:6379
  # host for redis+sentinel:
  #  <host_sentinel1>:<port_sentinel1>,<host_sentinel2>:<port_sentinel2>,<host_sentinel3>:<port_sentinel3>
  host: redis:6379
  # password for standalone Redis or sentinel mode
  password:
  # sentinel_master_set must be set to support redis+sentinel
  sentinel_master_set:
  # database index
  registry_db_index: 1
  jobservice_db_index: 2
  chartmuseum_db_index: 3
  trivy_db_index: 5
  idle_timeout_seconds: 30

# Uncomment external_database if using external database.
# external_database:
#   # harbor db host
#   host: harbor-db
#   # harbor db port
#   port: 5432
#   # harbor db username
#   username: postgres
#   # harbor db password
#   password: root123
#   # harbor db name
#   dbname: registry
#   # harbor db sslmode
#   sslmode: disable

# Uncomment external_redis if using external Redis server
# external_redis:
#   # redis connection host
#   host: redis:6379
#   # redis connection password
#   password:
#   # redis connection db index
#   registry_db_index: 1
#   jobservice_db_index: 2
#   chartmuseum_db_index: 3
#   trivy_db_index: 5

# Metric configurations
metric:
  # enabled the metric flag
  enabled: false 
  # prometheus pusher interval, unit: second
  interval: 15
  # prometheus server address
  url:

# Enable chartmuseum
chartmuseum:
  enabled: true

_version: 2.10.0
